<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mood-to-Music Recommender</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 0; text-align: center; color: #222; background: linear-gradient(135deg, #6a85b6, #bac8e0); }
    .container { max-width: 980px; margin: 30px auto; padding: 20px; }
    form { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; align-items: center; }
    select, input[type="text"], button { padding: 10px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
    select { min-width: 150px; } input[type="text"] { min-width: 220px; }
    button { padding: 10px 18px; border: none; background: #1DB954; color: white; cursor: pointer; border-radius: 8px; }
    .results { margin-top: 24px; text-align: left; }
    ul { list-style: none; padding: 0; } li { margin: 16px 0; padding: 12px; background: rgba(255,255,255,0.95); border-radius: 8px; }
    a { color: #1DB954; text-decoration: none; font-weight: 600; } .meta { color: #555; margin-top: 6px; }
    iframe { margin-top: 8px; border-radius: 6px; width: 100%; max-width: 780px; height: 80px; }
    h1 { transition: all 0.25s ease; margin-bottom: 10px; }
    body[data-mood="happy"] { background: linear-gradient(135deg,#ffecd2,#fcb69f); }
    body[data-mood="sad"] { background: linear-gradient(135deg,#89f7fe,#66a6ff); }
    body[data-mood="energetic"] { background: linear-gradient(135deg,#f6d365,#fda085); }
    body[data-mood="chill"] { background: linear-gradient(135deg,#a1c4fd,#c2e9fb); }
    body[data-mood="romantic"] { background: linear-gradient(135deg,#ff9a9e,#fecfef); }
  </style>
</head>
<body data-mood="{{ mood | default('') }}">
  <div class="container">
    <h1 id="title">üéß Mood-to-Music Recommender</h1>

    <form action="/recommend" method="POST" id="prefsForm">
      <select name="mood" required>
        <option value="">Select your mood</option>
        <option value="happy">üòä Happy</option>
        <option value="sad">üò¢ Sad</option>
        <option value="energetic">‚ö° Energetic</option>
        <option value="chill">üåô Chill</option>
        <option value="romantic">‚ù§Ô∏è Romantic</option>
      </select>

      <select name="language" id="language_select">
        <option value="">All languages</option>
        <option value="english">English</option>
        <option value="hindi">Hindi</option>
        <option value="marathi">Marathi</option>
        <option value="gujarati">Gujarati</option>
        <option value="tamil">Tamil</option>
        <option value="telugu">Telugu</option>
        <option value="kannada">Kannada</option>
        <option value="malayalam">Malayalam</option>
        <option value="spanish">Spanish</option>
      </select>

      <select name="activity">
        <option value="">No activity</option>
        <option value="driving">Driving</option>
        <option value="roadtrip">Roadtrip</option>
        <option value="cooking">Cooking</option>
        <option value="studying">Studying / Focus</option>
        <option value="coding">Coding</option>
        <option value="running">Running</option>
        <option value="gym">Gym / Workout</option>
        <option value="chilling">Relax / Chill</option>
        <option value="party">Party / Dancing</option>
        <option value="sleep">Sleep / Wind Down</option>
        <option value="bathing">Bathing</option>
        <option value="gaming">Gaming</option>
        <option value="date">Romantic Date</option>
      </select>

      <button type="submit">Find Songs</button>
    </form>

   {% for s in songs %}
  <li>
    <div>
      <a href="{{ s.url }}" target="_blank">{{ s.name }}</a>
      <div class="meta">{{ s.artist }}</div>
    </div>

    <!-- Primary: Spotify embed (click play manually) -->
    {% if s.id %}
      <iframe src="https://open.spotify.com/embed/track/{{ s.id }}" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
    {% endif %}

    <!-- Fallback: 30s preview (built-in HTML5 audio) -->
    {% if s.preview_url %}
      <div style="margin-top:8px;">
        <audio controls preload="none" src="{{ s.preview_url }}">
          Your browser does not support the audio element.
        </audio>
      </div>
    {% elif not s.id %}
      <!-- if neither id nor preview, show a link -->
      <div style="margin-top:8px;color:#666;font-size:13px;">No preview available ‚Äî open on Spotify to listen.</div>
    {% endif %}
  </li>
{% endfor %}


  <script>
    document.addEventListener("DOMContentLoaded", function() {
      let rawMood = "{{ mood | default('') }}";
      let mood = rawMood.trim().toLowerCase();
      const title = document.getElementById("title");
      const moodTitles = {
        "happy": "üòä Feel the Vibes!",
        "sad": "üíî Here to Heal Your Heart",
        "energetic": "‚ö° Pump Up Your Energy!",
        "chill": "üåô Relax and Unwind",
        "romantic": "‚ù§Ô∏è Songs for the Feels"
      };
      if (mood && moodTitles[mood]) {
        title.textContent = moodTitles[mood];
        document.body.setAttribute("data-mood", mood);
      } else {
        title.textContent = "üéß Mood-to-Music Recommender";
        document.body.setAttribute("data-mood", "");
      }
    });
  </script>
</body>
</html>
